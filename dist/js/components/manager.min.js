/**
 * @package     zlux
 * @version     2.0.3
 * @author      ZOOlanders - http://zoolanders.com
 * @license     GNU General Public License v2 or later
 */

!function(e,t,s){"use strict";var i;t.extensions.manager={id:0,init:function(){},getResource:function(e){return e instanceof jQuery?e.data("managerResource"):e},preResourceDelete:function(e,t){},deleteResource:function(s){var i=this,n={url:e.zx.url.ajax("zlux","deleteResource"),data:{type:i.type}};this.preResourceDelete(s,n),t.ajax.request(n).done(function(t){s.element.fadeOut("slow",function(){e(this).remove(),i.trigger("resourceDeleted",s)})}).fail(function(e){}).always(function(e){})},initResources:function(s){var i=this;s=void 0===s?i.find(".zx-manager-resources"):s,t.datatables(),i.resources=s.dataTable(e.extend(!0,{},t.datatables.settings,i.DTsettings)).DataTable(),i.DT_wrapper=s.closest(".dataTables_wrapper").addClass("uk-hidden"),i.resources.on("init",function(){i.trigger("resourcesInit")}),i.resources.on("click",".zx-x-details-btn",function(){var t=e(this),s=t.closest(".zx-manager-resource"),i=e(".zx-x-details",s);s.hasClass("zx-open")?(t.addClass("uk-icon-angle-down").removeClass("uk-icon-angle-up"),s.removeClass("zx-open"),i.slideUp("fast",function(){})):(s.addClass("zx-open"),t.removeClass("uk-icon-angle-down").addClass("uk-icon-angle-up"),i.slideDown("fast",function(){}))}),i.resources.on("click",".zx-manager-resource .zx-x-name a",function(t){t.preventDefault(),i.trigger("resourceSelected",i.getResource(e(this).closest(".zx-manager-resource")))}),i.resources.on("click",".zx-manager-resource .zx-x-remove",function(s){s.preventDefault();var n=i.getResource(e(this).closest(".zx-manager-resource"));t.notify.confirm(t.lang._("DELETE_THIS_RESOURCE"),{timeout:!1}).done(function(){i.deleteResource(n)})})},DTsettings:{serverSide:!0}},t.component("managerResource",{data:{editable:!1},defaults:{template:'<div class="zx-x-tools">                                <i class="zx-x-details-btn uk-icon-angle-down" />                                {{#editable}}                                <i class="zx-x-remove uk-icon-minus-circle" data-uk-tooltip title="'+t.lang._("DELETE")+'" />                                {{/some}}                            </div>                            <div class="zx-x-name"><a href="#" class="zx-x-name-link">{{name}}</a></div>                            {{#details && details.length}}                            <div class="zx-x-details">                                <div class="zx-x-messages" />                                <div class="zx-x-details-content">                                    <ul class="uk-list">                                        {{~details}}                                        <li>{{$item}}</li>                                        {{/details}}                                        </ul>                                </div>                            </div>                            {{/end}}'},init:function(){},render:function(){return e.UIkit.Utils.template(this.options.template,this.data)},pushData:function(t){this.data=e.extend({},this.data,t)}}),t.component("managerNav",{defaults:{template:'<ul class="uk-navbar-nav">                                <li class="uk-parent" data-uk-dropdown>                                    <a href=""><i class="uk-icon-bars"></i></a>                                    <div class="uk-dropdown uk-dropdown-navbar">                                        <ul class="uk-nav uk-nav-navbar">                                            <li><a href="">Another item</a></li>                                        </ul>                                    </div>                                </li>                            </ul>                            <div class="uk-navbar-content">                                <form class="uk-form uk-margin-remove uk-display-inline-block">                                   <input type="text" placeholder="Search">                                </form>                            </div>',option_tmpl:'<li><a href=""><i class="uk-icon-{{icon}}"></i> Some text </a></li>'},init:function(){this.element.append(this.options.template)},addChild:function(t){this.find(".uk-dropdown > ul").append(e.UIkit.Utils.template(this.options.option_tmpl,t))}}),t.extensions.managerDropdown=e.extend(!0,{},t.extensions.manager,{defaults:{init_display:"",offsettop:5,template:function(e,t){var s="";return s+='<div class="zx-manager-nav">',s+='<div class="uk-search">',s+='<input class="uk-search-field" type="search" placeholder="search...">',s+='<button class="uk-search-close" type="reset"></button>',s+="</div>",s+="</div>",s+='<div class="zx-manager-spinner uk-text-center"><i class="uk-icon-zx-spinner uk-icon-spin"></i></div>',s+='<table class="uk-table zx-manager-resources"></table>'}},init:function(){var t=this;this.current=this.element.val(),this.hidden=this.element.clone().attr("type","hidden").removeAttr("data-zx-itempicker").insertAfter(this.element),this.element.val(this.options.init_display).removeAttr("name"),this.on("focus",function(){e(".uk-search-field",this.dropdown).focus()}),this.on("resourcesInit",function(){t.DT_wrapper.closest(".dataTables_wrapper").removeClass("uk-hidden"),e(".zx-manager-spinner",this.dropdown).remove()})},initDropdown:function(t){var s=this;if(!t){t=e('<div class="uk-dropdown zx-manager zx"></div>');var i=null;t.on("keyup",".uk-search-field",function(n){var a=e(this).val();""===a?e(".uk-search-close",t).hide():e(".uk-search-close",t).show(),clearTimeout(i),""===a&&s.resources.search("").draw();var o=n.keyCode?n.keyCode:n.which;return 13==o?void s.resources.search(a).draw():void(i=setTimeout(function(){s.resources.search(a).draw()},500))}),t.on("click",".uk-search-close",function(i){e(".uk-search-field",t).val(""),e(this).hide(),s.resources.search("").draw()}),t.appendTo("body")}return this.dropdown=t,t},pick:function(t){var s=this.element.offset(),n={top:s.top+this.element.outerHeight()+this.options.offsettop,left:s.left,right:""};this.current=t?t:null,this.inititem=this.current,this.update(),"right"==e.UIkit.langdirection&&(n.right=window.innerWidth-(n.left+this.element.outerWidth()),n.left=""),this.dropdown.css(n).show(),e(".uk-search-field",i).focus()},update:function(){var t=this,s={},i=this.options.template(s,this.options);this.dropdown.html(i),t.on("resourceSelected",function(e,s){t.element.val(s.data.name),t.hidden.val(s.data.id)}),this.initResources(e(".zx-manager-resources",this.dropdown))}})}(jQuery,zlux,UIkit);